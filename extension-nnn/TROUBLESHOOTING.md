# üîß GUIDE DE D√âPANNAGE

Solutions aux probl√®mes courants de l'extension No Nut November.

---

## üö® ERREURS COURANTES

### ‚ùå Erreur : "Erreur de mise √† jour des r√®gles"

**Sympt√¥me** : Dans la console du Service Worker, tu vois :
```
Erreur de mise √† jour des r√®gles: [error details]
```

**Causes possibles** :

1. **Permission manquante**
   - Solution : V√©rifie que `manifest.json` contient :
   ```json
   "permissions": [
     "declarativeNetRequest",
     "declarativeNetRequestWithHostAccess"
   ]
   ```

2. **Format de r√®gle invalide**
   - Les r√®gles doivent utiliser `extensionPath` et non `url` pour les redirections
   - Solution : D√©j√† corrig√© dans la version √† jour

3. **Trop de r√®gles**
   - Chrome limite √† 5000 r√®gles dynamiques
   - Notre code limite √† 1000
   - Solution : R√©duis le nombre de sites personnalis√©s si tu en as beaucoup

**Comment r√©soudre** :

```bash
# 1. Recharger l'extension
chrome://extensions/ ‚Üí Bouton de rechargement ‚ü≥

# 2. V√©rifier la console du Service Worker
chrome://extensions/ ‚Üí Cliquer "Service Worker"
‚Üí Regarder s'il y a encore des erreurs

# 3. Si l'erreur persiste, r√©initialiser les donn√©es
Ouvrir la console du Service Worker et ex√©cuter:
chrome.storage.local.clear(() => console.log('Donn√©es effac√©es'));

# 4. Recharger l'extension √† nouveau
```

---

### ‚ùå Erreur : "Rule with id X does not have a unique ID"

**Sympt√¥me** : Dans la console du Service Worker :
```
D√©tails: Rule with id 1 does not have a unique ID.
```

**Cause** : Des r√®gles avec des IDs en doublon existent (g√©n√©ralement apr√®s plusieurs rechargements).

**Solution rapide** :

**M√©thode 1 - Automatique** (recommand√©) :
```javascript
// Dans la console du Service Worker :
chrome.declarativeNetRequest.getDynamicRules().then(rules => {
  const ids = rules.map(r => r.id);
  chrome.declarativeNetRequest.updateDynamicRules({
    removeRuleIds: ids
  }).then(() => {
    console.log('‚úÖ Toutes les r√®gles supprim√©es');
    console.log('üí° Recharge l\'extension maintenant');
  });
});
```

**M√©thode 2 - Manuelle** :
1. Va sur `chrome://extensions/`
2. Clique sur le bouton **‚ü≥ Recharger** de l'extension
3. Attends 2 secondes
4. V√©rifie la console : tu devrais voir "‚úÖ X r√®gles de blocage ajout√©es avec succ√®s"

**M√©thode 3 - Reset complet** (si les autres ne marchent pas) :
```javascript
// Console du Service Worker - Nettoie TOUT
chrome.declarativeNetRequest.getDynamicRules().then(r =>
  chrome.declarativeNetRequest.updateDynamicRules({
    removeRuleIds: r.map(x => x.id)
  })
).then(() => location.reload());
```

**Pr√©vention** :
- Ne recharge pas l'extension trop rapidement plusieurs fois de suite
- Attends que les logs "‚úÖ r√®gles ajout√©es" apparaissent avant de recharger

**Plus de d√©tails** : Voir [MAINTENANCE_SCRIPTS.md](MAINTENANCE_SCRIPTS.md) pour d'autres scripts de nettoyage.

---

### ‚ùå Erreur : "Could not load icon"

**Sympt√¥me** :
```
Could not load icon 'assets/icon16.png'
```

**Cause** : Les fichiers PNG d'ic√¥nes n'existent pas.

**Solution** :

1. Ouvre `generate-icons.html` dans Chrome
2. Fais un clic droit sur chaque canvas
3. "Enregistrer l'image sous..."
4. Sauvegarde dans `assets/` :
   - `icon16.png`
   - `icon48.png`
   - `icon128.png`
5. Recharge l'extension

---

### ‚ùå Le blocage ne fonctionne pas

**Sympt√¥me** : Les sites ne sont pas bloqu√©s, pas de redirection vers `blocked.html`.

**Diagnostic** :

1. **V√©rifier que le blocage est activ√©**
   ```
   Popup ‚Üí Param√®tres ‚Üí "Activer le blocage de sites" doit √™tre ON (vert)
   ```

2. **V√©rifier la console**
   ```
   chrome://extensions/ ‚Üí Service Worker
   ‚Üí Chercher "r√®gles de blocage ajout√©es"
   ‚Üí Devrait afficher : "X r√®gles de blocage ajout√©es"
   ```

3. **V√©rifier les r√®gles actives**
   ```javascript
   // Dans la console du Service Worker :
   chrome.declarativeNetRequest.getDynamicRules().then(rules => {
     console.log('R√®gles actives:', rules.length);
     console.log('Premi√®re r√®gle:', rules[0]);
   });
   ```

**Solutions** :

**Si 0 r√®gles actives** :
- Va dans Param√®tres
- Toggle "Activer le blocage" ‚Üí OFF puis ON
- V√©rifie la console pour confirmation

**Si le probl√®me persiste** :
- D√©sinstalle l'extension compl√®tement
- R√©installe
- R√©active le blocage

---

### ‚ùå Les donn√©es ne persistent pas

**Sympt√¥me** : Apr√®s fermeture de Chrome, les jours valid√©s disparaissent.

**Cause** : Probl√®me avec `chrome.storage.local`.

**Solution** :

1. **V√©rifier les permissions**
   - `manifest.json` doit avoir `"storage"` dans permissions

2. **V√©rifier les donn√©es manuellement**
   ```javascript
   // Dans n'importe quelle console de l'extension :
   chrome.storage.local.get(['challengeData'], (result) => {
     console.log('Donn√©es stock√©es:', result.challengeData);
   });
   ```

3. **Si les donn√©es sont vides** :
   - Valide un jour
   - V√©rifie √† nouveau
   - Si toujours vide ‚Üí Bug, reporte sur GitHub

---

### ‚ùå Les notifications ne s'affichent pas

**Sympt√¥me** : Aucune notification syst√®me.

**Diagnostic** :

1. **V√©rifier dans les param√®tres de l'extension**
   ```
   Popup ‚Üí Param√®tres ‚Üí "Notifications quotidiennes" doit √™tre ON
   ```

2. **V√©rifier les permissions syst√®me**
   ```
   Param√®tres Chrome ‚Üí Confidentialit√© et s√©curit√© ‚Üí Notifications
   ‚Üí Chrome doit √™tre autoris√©
   ```

3. **Tester manuellement**
   ```javascript
   // Dans la console du Service Worker :
   chrome.notifications.create({
     type: 'basic',
     iconUrl: 'assets/icon128.png',
     title: 'Test',
     message: 'Si tu vois √ßa, √ßa fonctionne !',
     priority: 2
   });
   ```

**Solution** :
- Active les permissions dans les param√®tres syst√®me
- R√©active dans les param√®tres de l'extension

---

### ‚ùå Le raccourci clavier ne fonctionne pas

**Sympt√¥me** : `Ctrl+Shift+V` / `Cmd+Shift+V` ne valide pas le jour.

**Diagnostic** :

1. **V√©rifier la configuration**
   ```
   chrome://extensions/shortcuts
   ‚Üí Chercher "No Nut November Challenge"
   ‚Üí V√©rifier le raccourci assign√©
   ```

2. **Conflit possible**
   - Un autre programme peut utiliser le m√™me raccourci
   - Essaye de changer le raccourci dans chrome://extensions/shortcuts

**Solution** :
- Change le raccourci pour un autre (ex: `Ctrl+Shift+N`)
- Ou utilise simplement le bouton dans le popup

---

### ‚ùå Le popup ne s'affiche pas

**Sympt√¥me** : Cliquer sur l'ic√¥ne ne fait rien.

**Diagnostic** :

1. **V√©rifier la console**
   ```
   Clic droit sur l'ic√¥ne ‚Üí Inspecter le popup
   ‚Üí Regarder la console pour les erreurs
   ```

2. **Erreur courante** : Fichiers manquants
   - `popup.html`, `popup.css`, `popup.js` doivent exister
   - `data/blocked-sites.json` doit exister

**Solution** :
- V√©rifie que tous les fichiers sont pr√©sents
- Recharge l'extension
- Si le probl√®me persiste, r√©installe

---

## üîç COMMANDES DE DEBUG UTILES

### V√©rifier l'√©tat de l'extension

```javascript
// Dans n'importe quelle console de l'extension
chrome.storage.local.get(null, (data) => {
  console.log('Toutes les donn√©es:', data);
});
```

### Forcer la mise √† jour des r√®gles

```javascript
// Dans la console du Service Worker
chrome.runtime.sendMessage({ action: 'updateBlockingRules' }, (response) => {
  console.log('R√®gles mises √† jour:', response);
});
```

### R√©initialiser compl√®tement

```javascript
// Dans n'importe quelle console
chrome.storage.local.clear(() => {
  console.log('Donn√©es effac√©es');
  location.reload();
});
```

### Voir toutes les r√®gles de blocage

```javascript
// Dans la console du Service Worker
chrome.declarativeNetRequest.getDynamicRules().then(rules => {
  console.table(rules);
});
```

### Supprimer toutes les r√®gles manuellement

```javascript
// Dans la console du Service Worker
chrome.declarativeNetRequest.getDynamicRules().then(rules => {
  const ids = rules.map(r => r.id);
  chrome.declarativeNetRequest.updateDynamicRules({
    removeRuleIds: ids
  }).then(() => console.log('Toutes les r√®gles supprim√©es'));
});
```

---

## üêõ SIGNALER UN BUG

Si tu rencontres un bug non list√© ici :

1. **Collecte d'informations** :
   - Version de Chrome : `chrome://version/`
   - Syst√®me d'exploitation
   - Description du bug
   - √âtapes pour reproduire
   - Capture d'√©cran si possible
   - Erreurs de console

2. **O√π signaler** :
   - GitHub Issues : [lien vers ton repo]
   - Email : [ton email]

3. **Template de bug report** :
   ```
   **Syst√®me**
   - OS : macOS 14.5 / Windows 11 / Linux Ubuntu 22.04
   - Chrome version : 120.0.6099.109
   - Extension version : 1.0.0

   **Description**
   [D√©cris le probl√®me]

   **√âtapes pour reproduire**
   1. ...
   2. ...
   3. ...

   **R√©sultat attendu**
   [Ce qui devrait se passer]

   **R√©sultat r√©el**
   [Ce qui se passe r√©ellement]

   **Erreurs console**
   ```
   [Colle les erreurs ici]
   ```

   **Screenshots**
   [Si applicable]
   ```

---

## ‚úÖ V√âRIFICATIONS G√âN√âRALES

Avant de chercher plus loin, v√©rifie toujours :

- [ ] Extension bien charg√©e dans `chrome://extensions/`
- [ ] "Mode d√©veloppeur" activ√©
- [ ] Pas d'erreur rouge dans chrome://extensions/
- [ ] Ic√¥nes PNG pr√©sentes dans `assets/`
- [ ] Service Worker actif (pas "inactive")
- [ ] Permissions accord√©es
- [ ] Extension √† jour (bouton reload cliqu√© apr√®s modifications)

---

## üîÑ R√âINSTALLATION PROPRE

Si rien ne fonctionne, r√©installe proprement :

1. **Exporter les donn√©es** (si tu veux les conserver)
   ```
   Popup ‚Üí Param√®tres ‚Üí Exporter les donn√©es (JSON)
   ```

2. **D√©sinstaller compl√®tement**
   ```
   chrome://extensions/ ‚Üí Supprimer l'extension
   ```

3. **Nettoyer le cache Chrome** (optionnel)
   ```
   chrome://settings/clearBrowserData
   ‚Üí Donn√©es en cache uniquement
   ```

4. **R√©installer**
   ```
   chrome://extensions/ ‚Üí Charger l'extension non empaquet√©e
   ```

5. **R√©importer les donn√©es** (si export√©es)
   ```javascript
   // Dans la console de l'extension
   const data = { /* coller les donn√©es JSON ici */ };
   chrome.storage.local.set({ challengeData: data.challengeData }, () => {
     console.log('Donn√©es restaur√©es');
     location.reload();
   });
   ```

---

## üìû SUPPORT

**Documentation** :
- [README.md](README.md) - Guide complet
- [QUICK_START.md](QUICK_START.md) - D√©marrage rapide
- [TESTING_GUIDE.md](TESTING_GUIDE.md) - Tests complets

**Aide suppl√©mentaire** :
- GitHub Issues (bugs et features)
- Documentation Chrome Extensions : https://developer.chrome.com/docs/extensions/

---

**La plupart des probl√®mes se r√©solvent avec un rechargement de l'extension !** üîÑ

*Derni√®re mise √† jour : Octobre 2024*
